<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a2332">
    <title>ADC Class of 2029 Chat</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-title">
                <h1>ğŸ“ ADC 2029</h1>
                <span class="header-subtitle">Live Chat</span>
            </div>

            <div style="display:flex;align-items:center;gap:8px;">
                <button class="header-refresh-btn" id="headerRefreshBtn" aria-label="Refresh">ğŸ”„</button>
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Connecting...</span>
                </div>
                <!-- Bell notification button -->
                <div class="bell-wrapper" style="position:relative;">
                    <button class="header-bell-btn" id="headerBellBtn" aria-label="Notifications">ğŸ””</button>
                    <span class="bell-badge" id="bellBadge" style="display:none;">0</span>
                </div>
                <!-- Mobile: settings gear in header -->
                <button class="header-settings-btn" id="headerSettingsBtn" aria-label="Settings">âš™ï¸</button>
            </div>
        </header>

        <div class="chat-container" id="chatContainer">
            <!-- Pull-to-refresh indicator -->
            <div class="pull-refresh-indicator" id="pullRefreshIndicator">
                <div class="pull-refresh-spin" id="pullRefreshSpin"></div>
                <span id="pullRefreshText">Pull to refresh</span>
            </div>

            <div id="messages" class="messages"></div>
            <div id="typingIndicator" class="typing-indicator" style="display:none;">
                <div class="typing-dots"><span></span><span></span><span></span></div>
                <span id="typingText"></span>
            </div>
        </div>

        <div class="input-container" id="inputContainer">
            <input
                type="text"
                id="messageInput"
                placeholder="Message..."
                maxlength="500"
                autocomplete="off"
                autocorrect="on"
                autocapitalize="sentences"
                enterkeyhint="send"
            />
            <button class="game-btn" id="gameBtn" onclick="openGameMenu()" aria-label="Games" title="Play a game">ğŸ®</button>
            <button id="sendBtn">Send</button>
        </div>
    </div>

    <!-- Desktop settings button (bottom-left FAB) -->
    <button class="settings-btn" id="settingsBtn" aria-label="Settings">âš™ï¸</button>

    <!-- Settings overlay -->
    <div class="settings-overlay" id="settingsOverlay"></div>

    <!-- Settings panel (bottom sheet on mobile, floating on desktop, side drawer on tablet) -->
    <div class="settings-panel" id="settingsPanel" role="dialog" aria-label="Settings">
        <div class="settings-header">
            <h3>âš™ï¸ Settings</h3>
            <button class="settings-close-btn" id="settingsCloseBtn" aria-label="Close settings">âœ•</button>
        </div>
        <div class="settings-content">
            <div class="settings-section">
                <h4>Profile Photo</h4>
                <div class="profile-image-section">
                    <div class="profile-avatar" id="profileAvatar" title="Click to change photo">
                        <span id="profileInitials">?</span>
                        <img id="profileImage" style="display:none;" alt="Profile">
                        <div class="profile-avatar-overlay">ğŸ“·</div>
                    </div>
                    <input type="file" id="profileImageInput" accept="image/*">
                    <button class="image-upload-btn" id="uploadImageBtn">ğŸ“· Change Photo</button>
                    <div id="uploadStatus" class="upload-status"></div>
                </div>
            </div>

            <div class="settings-section">
                <h4>Account</h4>
                <div class="account-info">
                    <p><strong>Name:</strong> <span id="accountName">Loading...</span></p>
                    <p><strong>Email:</strong> <span id="accountEmail">Loading...</span></p>
                </div>
                <div class="change-name-section" id="changeNameSection" style="display:none;">
                    <input type="text" id="changeNameInput" class="change-name-input" placeholder="New display name" maxlength="30">
                    <div class="change-name-buttons">
                        <button class="save-name-btn" id="saveNameBtn">âœ“ Save</button>
                        <button class="cancel-name-btn" id="cancelNameBtn">âœ• Cancel</button>
                    </div>
                    <div id="changeNameStatus" class="upload-status"></div>
                </div>
                <button class="change-name-btn" id="changeNameBtn">âœï¸ Change Name</button>
                <button class="logout-btn" id="logoutBtn">ğŸšª Logout</button>
            </div>

            <div class="settings-section">
                <h4>Members</h4>
                <button class="members-btn" id="membersBtn">ğŸ‘¥ View All Members</button>
            </div>
        </div>
    </div>

    <!-- Notifications panel -->
    <div class="notifications-overlay" id="notificationsOverlay"></div>
    <div class="notifications-panel" id="notificationsPanel">
        <div class="notifications-header">
            <h3>ğŸ”” Notifications</h3>
            <button class="notifications-close" id="notificationsClose">âœ•</button>
        </div>
        <div class="notifications-list" id="notificationsList">
            <div style="text-align:center;color:#888;padding:20px;">No notifications</div>
        </div>
    </div>

    <!-- Delete confirmation modal -->
    <div class="modal-overlay" id="deleteModal" role="dialog" aria-label="Confirm delete">
        <div class="modal">
            <h3>Delete Message?</h3>
            <p>This action cannot be undone.</p>
            <div class="modal-actions">
                <button class="modal-btn cancel" onclick="cancelDelete()">Cancel</button>
                <button class="modal-btn confirm" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>

    <!-- Image Cropper Modal -->
    <div class="cropper-modal-overlay" id="cropperModal" role="dialog" aria-label="Crop photo">
        <div class="cropper-modal">
            <div class="cropper-modal-header">
                <h3>âœ‚ï¸ Crop Photo</h3>
                <button class="cropper-close-btn" id="cropperCloseBtn">âœ•</button>
            </div>
            <div class="cropper-viewport" id="cropperViewport">
                <!-- Canvas drawn by JS -->
            </div>
            <div class="cropper-instruction">Drag to move â€¢ Scroll/pinch to zoom</div>
            <div class="cropper-footer">
                <div class="cropper-preview">
                    <img id="cropperPreview" src="" alt="Preview">
                </div>
                <div class="cropper-actions">
                    <button class="cropper-btn cancel" id="cropperCancelBtn">Cancel</button>
                    <button class="cropper-btn save" id="cropperSaveBtn">Save Photo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Menu -->
    <div class="game-menu-overlay" id="gameMenuOverlay" onclick="closeGameMenu()"></div>
    <div class="game-menu" id="gameMenu" role="dialog" aria-label="Game Menu">
        <div class="game-menu-header">
            <h3>ğŸ® Games</h3>
            <button class="game-menu-close" onclick="closeGameMenu()">âœ•</button>
        </div>
        <div class="game-menu-body">
            <!-- Pending invites section -->
            <div id="gameMenuInvites" style="display:none;">
                <div class="game-menu-section-label">âš”ï¸ Invites</div>
                <div id="gameMenuInvitesList"></div>
            </div>

            <!-- Ongoing games section -->
            <div id="ongoingGamesSection" style="display:none;">
                <div class="game-menu-section-label">ğŸ“‹ Your Active Games</div>
                <div id="ongoingGamesList"></div>
            </div>

            <!-- New game -->
            <div class="game-menu-section-label">ğŸ†• New Game</div>
            <div class="game-card">
                <div class="game-card-title">ğŸŸ¦ Ultimate Tic-Tac-Toe</div>
                <div class="game-card-desc">9 boards in a grid â€” win 3 boards to win the match!</div>
                <div class="game-card-actions">
                    <div class="challenge-someone-row">
                        <select id="challengeUserSelect" class="challenge-select">
                            <option value="">-- Pick a player --</option>
                        </select>
                        <button class="game-action-btn primary" onclick="sendTargetedChallenge()">Challenge!</button>
                    </div>
                    <button class="game-action-btn secondary" onclick="sendOpenChallenge()">ğŸ“¢ Open Challenge</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Modal (Ultimate Tic-Tac-Toe board) -->
    <div class="game-modal-overlay" id="gameModal" role="dialog" aria-label="Ultimate Tic-Tac-Toe">
        <div class="game-modal">
            <div class="game-modal-header">
                <div class="game-players-row">
                    <span class="player-label x" id="playerXLabel">Player X</span>
                    <span class="game-vs">vs</span>
                    <span class="player-label o" id="playerOLabel">Player O</span>
                </div>
                <button class="game-modal-close" onclick="closeGameModal()">âœ•</button>
            </div>
            <div class="game-turn-status your-turn" id="gameTurnStatus">Your turn</div>
            <div class="big-board" id="bigBoard"></div>
            <div class="game-over-overlay" id="gameOverOverlay">
                <div class="game-over-text" id="gameOverText">Game Over</div>
                <button class="game-over-btn" onclick="gamePlayAgain()">ğŸ® Play Again</button>
                <button class="game-over-btn secondary" onclick="closeGameModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <div class="game-toast" id="gameToast"></div>

    <!-- Profile card modal -->
    <div class="profile-card-overlay" id="profileCardOverlay">
        <div class="profile-card">
            <button class="profile-card-close" id="profileCardClose">âœ•</button>
            <div class="profile-card-avatar" id="profileCardAvatar"></div>
            <div class="profile-card-name" id="profileCardName"></div>
            <div class="profile-card-status" id="profileCardStatus"></div>
            <div class="profile-card-email" id="profileCardEmail"></div>
        </div>
    </div>

    <!-- Members list modal -->
    <div class="members-overlay" id="membersOverlay">
        <div class="members-panel">
            <div class="members-header">
                <h3>ğŸ‘¥ Members</h3>
                <button class="members-close" id="membersClose">âœ•</button>
            </div>
            <div class="members-list" id="membersList">
                <div style="text-align:center;color:#888;padding:20px;">Loading...</div>
            </div>
        </div>
    </div>

    <script src="game-ttt.js"></script>
    <script src="app-cloudflare.js"></script>
</body>
</html>
