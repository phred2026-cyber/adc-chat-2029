<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a2332">
    <title>ADC Class of 2029 Chat</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-title">
                <h1>üéì ADC 2029</h1>
                <span class="header-subtitle">Live Chat</span>
            </div>

            <div style="display:flex;align-items:center;gap:8px;">
                <button class="header-refresh-btn" id="headerRefreshBtn" aria-label="Refresh">üîÑ</button>
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Connecting...</span>
                </div>
                <!-- Mobile: settings gear in header -->
                <button class="header-settings-btn" id="headerSettingsBtn" aria-label="Settings">‚öôÔ∏è</button>
            </div>
        </header>

        <div class="chat-container" id="chatContainer">
            <!-- Pull-to-refresh indicator -->
            <div class="pull-refresh-indicator" id="pullRefreshIndicator">
                <div class="pull-refresh-spin" id="pullRefreshSpin"></div>
                <span id="pullRefreshText">Pull to refresh</span>
            </div>

            <div id="messages" class="messages"></div>
            <div id="typingIndicator" class="typing-indicator" style="display:none;">
                <div class="typing-dots"><span></span><span></span><span></span></div>
                <span id="typingText"></span>
            </div>
        </div>

        <div class="input-container" id="inputContainer">
            <input
                type="text"
                id="messageInput"
                placeholder="Message..."
                maxlength="500"
                autocomplete="off"
                autocorrect="on"
                autocapitalize="sentences"
                enterkeyhint="send"
            />
            <button class="game-btn" id="gameBtn" onclick="openGameMenu()" aria-label="Games" title="Play a game">üéÆ</button>
            <button id="sendBtn">Send</button>
        </div>
    </div>

    <!-- Desktop settings button (bottom-left FAB) -->
    <button class="settings-btn" id="settingsBtn" aria-label="Settings">‚öôÔ∏è</button>

    <!-- Settings overlay -->
    <div class="settings-overlay" id="settingsOverlay"></div>

    <!-- Settings panel -->
    <div class="settings-panel" id="settingsPanel" role="dialog" aria-label="Settings">
        <div class="settings-header">
            <h3>‚öôÔ∏è Settings</h3>
            <button class="settings-close-btn" id="settingsCloseBtn" aria-label="Close settings">‚úï</button>
        </div>
        <div class="settings-content">
            <div class="settings-section">
                <h4>Profile Photo</h4>
                <div class="profile-image-section">
                    <div class="profile-avatar" id="profileAvatar" title="Click to change photo">
                        <span id="profileInitials">?</span>
                        <img id="profileImage" style="display:none;" alt="Profile">
                        <div class="profile-avatar-overlay">üì∑</div>
                    </div>
                    <input type="file" id="profileImageInput" accept="image/*">
                    <button class="image-upload-btn" id="uploadImageBtn">üì∑ Change Photo</button>
                    <div id="uploadStatus" class="upload-status"></div>
                </div>
            </div>

            <div class="settings-section">
                <h4>Account</h4>
                <div class="account-info">
                    <p><strong>Name:</strong> <span id="accountName">Loading...</span></p>
                    <p><strong>Email:</strong> <span id="accountEmail">Loading...</span></p>
                </div>
                <button class="logout-btn" id="logoutBtn">üö™ Logout</button>
            </div>
        </div>
    </div>

    <!-- Delete confirmation modal -->
    <div class="modal-overlay" id="deleteModal" role="dialog" aria-label="Confirm delete">
        <div class="modal">
            <h3>Delete Message?</h3>
            <p>This action cannot be undone.</p>
            <div class="modal-actions">
                <button class="modal-btn cancel" onclick="cancelDelete()">Cancel</button>
                <button class="modal-btn confirm" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>

    <!-- Image Cropper Modal -->
    <div class="cropper-modal-overlay" id="cropperModal" role="dialog" aria-label="Crop photo">
        <div class="cropper-modal">
            <div class="cropper-modal-header">
                <h3>‚úÇÔ∏è Crop Photo</h3>
                <button class="cropper-close-btn" id="cropperCloseBtn">‚úï</button>
            </div>
            <div class="cropper-viewport" id="cropperViewport">
                <!-- Canvas drawn by JS -->
            </div>
            <div class="cropper-instruction">Drag to move ‚Ä¢ Scroll/pinch to zoom</div>
            <div class="cropper-footer">
                <div class="cropper-preview">
                    <img id="cropperPreview" src="" alt="Preview">
                </div>
                <div class="cropper-actions">
                    <button class="cropper-btn cancel" id="cropperCancelBtn">Cancel</button>
                    <button class="cropper-btn save" id="cropperSaveBtn">Save Photo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Menu -->
    <div class="game-menu-overlay" id="gameMenuOverlay" onclick="closeGameMenu()"></div>
    <div class="game-menu" id="gameMenu" role="dialog" aria-label="Game Menu">
        <div class="game-menu-header">
            <h3>üéÆ Games</h3>
            <button class="game-menu-close" onclick="closeGameMenu()">‚úï</button>
        </div>
        <div class="game-menu-content">
            <div class="game-card">
                <div class="game-card-title">üü¶ Ultimate Tic-Tac-Toe</div>
                <div class="game-card-desc">9 boards in a grid ‚Äî win 3 boards to win the match!</div>
                <div class="game-card-actions">
                    <div class="challenge-someone-row">
                        <select id="challengeUserSelect" class="challenge-select">
                            <option value="">-- Pick a player --</option>
                        </select>
                        <button class="game-action-btn primary" onclick="sendTargetedChallenge()">Challenge!</button>
                    </div>
                    <button class="game-action-btn secondary" onclick="sendOpenChallenge()">üì¢ Open Challenge</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Modal (Ultimate Tic-Tac-Toe board) -->
    <div class="game-modal-overlay" id="gameModal" role="dialog" aria-label="Ultimate Tic-Tac-Toe">
        <div class="game-modal">
            <div class="game-modal-header">
                <div class="game-players-row">
                    <span class="player-label x" id="playerXLabel">Player X</span>
                    <span class="game-vs">vs</span>
                    <span class="player-label o" id="playerOLabel">Player O</span>
                </div>
                <button class="game-modal-close" onclick="closeGameModal()">‚úï</button>
            </div>
            <div class="game-turn-status your-turn" id="gameTurnStatus">Your turn</div>
            <div class="big-board" id="bigBoard"></div>
            <div class="game-over-overlay" id="gameOverOverlay">
                <div class="game-over-text" id="gameOverText">Game Over</div>
                <button class="game-over-btn" onclick="gamePlayAgain()">üéÆ Play Again</button>
                <button class="game-over-btn secondary" onclick="closeGameModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <div class="game-toast" id="gameToast"></div>

    <script src="game-ttt.js"></script>
    <script src="app-cloudflare.js"></script>
</body>
</html>
